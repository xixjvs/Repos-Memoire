version: '3.8'


services:
 app:
   build: .
   container_name: app_memoire_container
   ports:
     - "8888:80"
   volumes:
     - .:/var/www/html
   depends_on:
     - db
 db:
   image: mysql:5.7
   container_name: db_memoire
   restart: always
   logging:  # ‚Üê Ajoutez cette section
     driver: "json-file"
     options:
       max-size: "10m"
       max-file: "3"
      
   environment:
     MYSQL_ROOT_PASSWORD: app_pass
     MYSQL_DATABASE: demandegrace
     MYSQL_USER: app_user
     MYSQL_PASSWORD: app_pass
   ports:
     - "3306:3306"
   volumes:
     - db_data:/var/lib/mysql
     - ./demandegrace.sql:/docker-entrypoint-initdb.d/init.sql


 cadvisor:
   image: gcr.io/cadvisor/cadvisor:latest
   container_name: cadvisor
   ports:
     - "8081:8080"
   volumes:
     - /:/rootfs:ro
     - /var/run:/var/run:ro
     - /sys:/sys:ro
     - /var/lib/docker/:/var/lib/docker:ro
   networks:
     - monitoring


volumes:
 db_data:
 grafana_data:


networks:
 monitoring:
